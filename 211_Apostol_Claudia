#include <iostream>
#include <vector>
#include <stdlib.h>
#include <typeinfo>
#include <utility>
#include <bits/stdc++.h>
using namespace std;

class locuinta
{
protected:
    string numeclient;
    double supraf;
    double discount;
    static int nrloc;
public:
    static void locuinte()
    {
        cout<<"S-au creat "<<nrloc<<" locuinte"<<endl;
    }
    int ret_nrloc()
    {
        return nrloc;
    }
    locuinta(string nume="",double s=0,double di=0)
    {
        numeclient=nume;
    try
    {
        if (s<0)
            throw s;
    }
    catch (double x)
    {
        cout<<"Eroare in constructor, suprafata nu poate fi negativa.\n";
        exit(EXIT_FAILURE);
    }
        supraf=s;
     try
    {
        if (di<0||di>10)
            throw di;
    }
    catch (double x)
    {
        cout<<"Eroare in constructor, disconutul trebuie sa fie intre 0-10%.\n";
        exit(EXIT_FAILURE);
    }
        discount=di;
        nrloc++;
    }
    ~locuinta()
{

}
    virtual void citire(istream& in)
    {
        cout<<"Introduceti numele clientului: ";
        getline(in,numeclient);
        cout<<"Introduceti suprafata locuintei: ";
        double s;
        in>>s;
        try
    {
        if (s<0)
            throw s;
    }
    catch (double x)
    {
        cout<<"Suprafata nu poate fi negativa.\n";
        exit(EXIT_FAILURE);
    }
        supraf=s;

        int ok=0;
        while(ok==0)
        {cout<<"Introduceti discountul(0-10%): ";
        in>>discount;
        if(discount<0||discount>10)
            cout<<"Discount incorect";
        else ok=1;}

    }
    virtual void afisare(ostream& out)
    {
        out<<endl<<"Nume client: "<<numeclient<<endl;
        out<<"Suprafata locuintei: "<<supraf<<endl;
        out<<"Discount: "<<discount<<endl;

    }
    friend istream& operator>>(istream&in, locuinta& l)
    {
        l.citire(in);
        return in;
    }
    friend ostream& operator<<(ostream& out,locuinta& l)
    {
        l.afisare(out);
        return out;
    }
    locuinta& operator=(locuinta& l)
    {
        this->numeclient=l.numeclient;
        this->discount=l.discount;
        this->supraf=l.supraf;
        return *this;
    }
//    locuinta( locuinta const& l)
//    {   ///cout<<"Copy";
//        if(this!=&l)
//         {numeclient=l.numeclient;
//         discount=l.discount;
//         supraf=l.supraf;
//         nrloc++;}
//    }
 locuinta( locuinta* const& l)
    {
         numeclient=l->numeclient;
         discount=l->discount;
         supraf=l->supraf;
         nrloc++;
    }
   virtual double chirie()
   {

   }

};
int locuinta::nrloc;
class apartament: public locuinta
{
protected:
    int etaj;
    double pret;
public:
    apartament(string nume="",double sup=0,double d=0,int e=0, double pr=0):locuinta(nume,sup,d)
    {
        etaj=e;
        pret=pr;
    }
    ~apartament()
    {

    }
    void citire(istream& in)
    {
        locuinta::citire(in);
        int ok=0;
        while(ok==0)
        {cout<<"Introduceti etajul: ";
        in>>etaj;
        if(etaj<0|| etaj>10)
            cout<<"Etaj incorect"<<endl;
            else ok=1;}
        cout<<"Introduceti pretul pe metru patrat: ";
        in>>pret;

    }
    void afisare(ostream& out)
    {
        locuinta::afisare(out);
        out<<"Etaj: "<<etaj;
        out<<endl<<"Pret pe metru patrat: "<<pret;
        out<<endl<<"Chiria pentru apartament: "<<chirie(*this);
    }
    friend istream& operator>>(istream&in, apartament& l)
    {
        l.citire(in);
        return in;
    }
    friend ostream& operator<<(ostream& out,apartament& l)
    {
        l.afisare(out);
        return out;
    }
    apartament& operator=(apartament& a)
    {
        this->locuinta::operator=(a);
        this->etaj=a.etaj;
        this->pret=a.pret;
        return *this;
    }
    apartament(const apartament& a):locuinta(a)
    {
        ///cout<<"copy apartament";
        if(this!=&a)
        {etaj=a.etaj;
        pret=a.pret;}

    }
    double chirie(apartament &a)
    {
        double aux=a.pret*a.supraf;
        if(a.discount!=0)
        aux=aux-(aux*a.discount)/100;
        return aux;
    }
};
class casa: public locuinta
{
protected:
    double curte;
    int nretaje;
    double pret;
    vector <double> etaj;
public:
    casa(string nume="",double sup=0,double d=0,double c=0,int nr=0,vector <double> et={}):locuinta(nume,sup,d)
    {
        curte=c;
        nretaje=nr;
        etaj=et;
    }
    ~casa()
    {

    }
    casa(const casa& c):locuinta(c)
    {
        if(this!=&c)
        {cout<<"Copy casa";
        curte=c.curte;
        nretaje=c.nretaje;
        pret=c.pret;
        etaj=c.etaj;
        }
    }
    casa& operator=(casa& c)
    {
        this->locuinta::operator=(c);
        this->curte=c.curte;
        this->nretaje=c.nretaje;
        this->pret=c.pret;
        this->etaj=c.etaj;
        return *this;
    }
    void citire(istream& in)
    {
        locuinta::citire(in);
        cout<<"Introduceti suprafata curtii: ";
        in>>curte;
        cout<<"Introduceti cate etaje are casa: (0= parter) ";
        in>>nretaje;
        double aux;
//        if(nretaje==0)
//            {cout<<"Etajul 0 are suprafata: ";
//            in>>aux;
//            etaj.push_back(aux);
//            cout<<endl;
//            }
//        else
        for(int i=0;i<=nretaje;i++)
        {
            ///0 etaje = doar parter
            /// sau 1 etaj = doar parter
            ///???

            cout<<"Etajul "<<i<<" are suprafata: ";
            in>>aux;
            etaj.push_back(aux);


        }
        cout<<"Introduceti pretul pentru metrul patrat de curte: ";
        in>>pret;

    }
    void afisare(ostream& out)
    {
        locuinta::afisare(out);
        out<<"Suprafata curtii: "<<curte<<endl<<"Numar de etaje: "<<nretaje<<endl;
//        if(nretaje==0)
//            cout<<"Etajul 0: "<<etaj[0]<<endl;
//        else
        for(int i=0;i<=nretaje;i++)
            {cout<<"Etajul "<<i<<": "<<etaj[i];
             cout<<endl;}

        cout<<"Chiria pentru casa: "<<chirie(*this);

    }
     friend istream& operator>>(istream&in, casa& l)
    {
        l.citire(in);
        return in;
    }
    friend ostream& operator<<(ostream& out,casa& l)
    {
        l.afisare(out);
        return out;
    }
    double chirie(casa& c)
    {
        double aux=0;
//        for(int i=0;i<=nretaje;i++)
//            aux=aux+pret*etaj[i];
        aux=aux+c.supraf*c.pret;
        if(discount!=0)
            aux=aux-(aux*discount)/100;
        aux+=c.pret*c.curte;
        return aux;
    }
};
void tip(locuinta*&l, int i)
{
    cout<<endl<<"Introduceti tipul de locuinta(a/c): ";
    string aux;
    cin>>aux;
    if(aux=="c")
    {
        l=new casa;

        cin.get();
        cin>>*l;
    }
    else if(aux=="a")
    {
        l=new apartament;
        cin.get();
        cin>>*l;
    }
    else cout<<"Caracter invalid";
}
template <class T>
class gestiune
{
    //set<pair<locuinta,string>> s;
    T *vect;
    int nr;
public:
    gestiune(T *v={},int n=0)
    {
        nr=n;
        if(n>0)
        {vect=new T[n];
        for(int i=0;i<n;i++)
            vect[i]=v[i];
        }
    }
    gestiune(gestiune &g)
    {
         nr=g.n;
        if(nr>0)
        {vect=new T[nr];
        for(int i=0;i<nr;i++)
            vect[i]=g.v[i];
        }
    }
    ~gestiune()
    {
        delete []vect;
    }
    friend istream& operator>>(istream& in,gestiune <T> &g)
    {
        cout<<"Introduceti numarul de locuinte: ";

        in>>g.nr;
        cout<<endl;
        g.vect=new T[g.nr];
        for(int i=0;i<g.nr;i++)
            {cout<<"Locuinta "<<i+1<<":"<<endl;
                string buff;
                getline(cin,buff);
                in>>g.vect[i];
                cout<<endl;

            }
            return in;
    }
    friend ostream& operator<<(ostream& out, gestiune<T> &g)
    {
            out<<"S-au vandut "<<g.nr<<" locuinte ";
            for(int i=0;i<g.nr;i++)
            {
                out<<endl<<endl;
                out<<i+1<<":";
                out<<g.vect[i];

            }
            return out;


    }
//    int operator+=(locuinta&l)
//    {
//        vect.push_back(l);
//
//        return ret_nrloc();
//    }

};
typedef pair<locuinta, string> pairs;

template<>class gestiune<casa>
{
    casa* c;
    int nrcase;
    double profit;
public:
    gestiune(casa* a=NULL,int nr=0)
    {
        nrcase=nr;
        profit=0;
        c=new casa[nrcase];
        for(int i=0;i<nrcase;i++)
            {c[i]=a[i];
                profit+=c[i].chirie(c[i]);}

    }
    ~gestiune()
    {
        delete [] c;
    }
    gestiune(const gestiune &s)
    {
       /// cout<<"copy specializare";
        nrcase=s.nrcase;
        c=new casa[nrcase];
        for(int i=0;i<nrcase;i++)
            c[i]=s.c[i];
    }
    friend istream& operator>>(istream &in,gestiune<casa> &cg)
    {
        cout<<"Introduceti numarul de case: ";
        in>>cg.nrcase;
        cg.c=new casa[cg.nrcase];
        for(int i=0;i<cg.nrcase;i++)
        {
            cout<<"Casa "<<i+1<<":"<<endl;
            string buf;
            getline(cin,buf);
            in>>cg.c[i];
            cg.profit+=cg.c[i].chirie(cg.c[i]);
            cout<<endl;
        }
        return in;
    }
    friend ostream& operator<<(ostream& out,gestiune<casa> &cg)
    {
        out<<"Au fost vandute "<<cg.nrcase<<" case"<<endl;
        out<<"Profitul agentiei este de: "<<cg.profit;
        return out;

    }

};
void menu_output()
{
    cout<<"Apostol Claudia grupa 211 - tema 9"<<endl;
    cout<<endl<<"MENIU"<<endl;
    cout<<"---------------------------------------"<<endl;
    cout<<endl;
    cout<<"1. Citirea a n locuinte"<<endl;
    cout<<"2. Template -> locuinta"<<endl;
    cout<<"3. Template -> apartament"<<endl;
    cout<<"4. Template -> casa (specializare)"<<endl;
    cout<<"5. "<<endl;
    cout<<"0. Iesire"<<endl;
}
void menu()
{
    int option,nr,ok;
    locuinta **l;
    do
    {
        menu_output();
        cout<<"Introduceti numarul actiunii: ";
        cin>>option;
        if(option>5||option<0)
            cout<<"Selectie invalida"<<endl;
        if(option==0)
            cout<<"EXIT"<<endl;
        if(option==1)
        {
             cout<<endl<<"Introduceti numarul de locuinte citite: ";
                cin>>nr;
            try
            {
                l=new locuinta*[nr];
                cout<<endl;
                for(int i=0; i<nr;i++ )
                {
                    cout<<i+1<<": ";
                    tip(l[i],i);
                    cout<<endl;
                }
            }
            catch(bad_alloc var)
            {
                cout<<"bad alloc"<<endl;
                exit(EXIT_FAILURE);
            }
            ok=1;
            cout<<endl;
            for(int i=0;i<nr;i++)
                { cout<<i+1<<":"<<endl;cout<<*l[i]; cout<<endl;}
        }
        if(option==2)
        {
            gestiune<locuinta> x;
            cin>>x;
            cout<<x;
        }
        if(option==3)
        {
            gestiune <apartament>x;
            cin>>x;
            cout<<x;
        }
        if(option==4)
        {
            gestiune<casa> x;
            cin>>x;
            cout<<x;
        }
         system("pause");
        system("cls");

    }while(option!=0);

}
int main()
{
//    locuinta **l;
//    int n;
//    cout<<"Introduceti numarul de locuinte: ";
//    cin>>n;
//    l=new locuinta*[n];
//    for(int i=1;i<=n;i++)
//    {cout<<endl;tip(l[i],i);}
//
//    for(int i=1;i<=n;i++)
//        cout<<*l[i];

//    locuinta *l=new locuinta;
//    //apartament *m;
//    apartament *m;
//    cin>>*l;
//
//    //delete l;
//    cout<<*l;
//    string aux;
//    getline(cin,aux);
//    int j;
//    cin>>j;

//string tip;
//vector <pairs> ciudi;
//locuinta *a;
//for(int i=0;i<3;i++)
//    {
//        cin>>tip;
//        if(tip=="apartament")
//            { a=new apartament;
//            string aux;
//                getline(cin,aux);
//                cin>>*a;
//                pairs x=make_pair(dynamic_cast<apartament*>(a),tip);
//                cout<<x.first<<endl<<x.second;
//               //ciudi.insert(x);
//                ciudi.push_back(x);
//
//            }
//            else
//            {
//                if(tip=="casa")
//                    {
//                        a=new casa;
//            string aux;
//                getline(cin,aux);
//                cin>>*a;
//                pairs x=make_pair(*a,tip);
//                cout<<x.first<<endl<<x.second;
//                ciudi.push_back(x);
//                    }
//                    else cout<<"Tip invalid. Introduceti apartament/casa"<<endl;
//            }
//    }
//    if(ciudi.empty()==1)
//    cout<<"un cur";
//    for(vector<pairs>::iterator it = ciudi.begin() ; it != ciudi.end(); ++it)
//            {
//               pairs i=*it;
//               apartament ap=(apartament&)i.first;
//               cout<<endl<<ap<<endl<<i.second<<endl;
//               cout<<typeid(i.first).name();
//            }

    menu();
    gestiune<apartament> x;
    cin>>x;
    cout<<x;
//    casa *l=new casa;
//    cin>>*l;
//    casa m(*l);
//    delete l;
//    cout<<m;
    return 0;
}

